<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>localStorage Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .btn:hover {
            background: #45a049;
        }
        .btn-danger {
            background: #f44336;
        }
        .btn-danger:hover {
            background: #da190b;
        }
        .result {
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            max-height: 400px;
            overflow-y: auto;
        }
        .success {
            color: green;
            font-weight: bold;
        }
        .error {
            color: red;
            font-weight: bold;
        }
        .warning {
            color: orange;
            font-weight: bold;
        }
        input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 10px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <h1>ğŸ” localStorage Test AracÄ±</h1>
    
    <div class="card">
        <h2>supplierListForCOA KontrolÃ¼</h2>
        <button class="btn" onclick="checkSupplierList()">ğŸ” Kontrol Et</button>
        <button class="btn" onclick="window.open('index.html', '_blank')">ğŸ“„ Ana Sayfa</button>
        <button class="btn" onclick="window.open('coa-arsiv.html', '_blank')">ğŸ“‹ COA ArÅŸiv</button>
        <div id="result1" class="result" style="display:none;"></div>
    </div>
    
    <div class="card">
        <h2>Manuel Test</h2>
        <input type="text" id="testNames" placeholder="TedarikÃ§i isimleri girin (virgÃ¼lle ayÄ±rÄ±n)" value="Test Firma A, Test Firma B, Test Firma C">
        <button class="btn" onclick="saveTestData()">ğŸ’¾ Test Verisi Kaydet</button>
        <button class="btn btn-danger" onclick="clearData()">ğŸ—‘ï¸ TÃ¼mÃ¼nÃ¼ Sil</button>
        <div id="result2" class="result" style="display:none;"></div>
    </div>
    
    <div class="card">
        <h2>TÃ¼m localStorage AnahtarlarÄ±</h2>
        <button class="btn" onclick="showAllKeys()">ğŸ“‹ TÃ¼m AnahtarlarÄ± GÃ¶ster</button>
        <div id="result3" class="result" style="display:none;"></div>
    </div>
    
    <script>
        function checkSupplierList() {
            const result = document.getElementById('result1');
            result.style.display = 'block';
            
            const data = localStorage.getItem('supplierListForCOA');
            
            if (!data) {
                result.innerHTML = '<span class="error">âŒ supplierListForCOA bulunamadÄ±!</span><br><br>' +
                    '<strong>Ã‡Ã¶zÃ¼m:</strong><br>' +
                    '1. Ana sayfada Excel yÃ¼kleyin<br>' +
                    '2. TarayÄ±cÄ± konsolunu kontrol edin (F12)<br>' +
                    '3. Ctrl+Shift+R ile hard refresh yapÄ±n<br>' +
                    '4. Bu sayfayÄ± yenileyin ve tekrar kontrol edin';
                return;
            }
            
            try {
                const list = JSON.parse(data);
                if (!Array.isArray(list)) {
                    result.innerHTML = '<span class="error">âŒ Veri formatÄ± hatalÄ±! Array deÄŸil.</span>';
                    return;
                }
                
                if (list.length === 0) {
                    result.innerHTML = '<span class="warning">âš ï¸ Liste boÅŸ!</span><br><br>' +
                        'Ana sayfada Excel dosyasÄ± yÃ¼klÃ¼ deÄŸil veya hiÃ§ tedarikÃ§i yok.';
                    return;
                }
                
                result.innerHTML = '<span class="success">âœ… Liste baÅŸarÄ±yla yÃ¼klendi!</span><br><br>' +
                    `<strong>Toplam TedarikÃ§i:</strong> ${list.length}<br><br>` +
                    '<strong>Ä°lk 10 TedarikÃ§i:</strong><br>' +
                    list.slice(0, 10).map((s, i) => `${i+1}. ${s}`).join('<br>') + '<br><br>' +
                    (list.length > 10 ? '<strong>...</strong><br><br>' : '') +
                    '<strong>Son 5 TedarikÃ§i:</strong><br>' +
                    list.slice(-5).map((s, i) => `${list.length - 4 + i}. ${s}`).join('<br>');
                    
            } catch (e) {
                result.innerHTML = '<span class="error">âŒ JSON parse hatasÄ±:</span><br>' + e.message;
            }
        }
        
        function saveTestData() {
            const result = document.getElementById('result2');
            result.style.display = 'block';
            
            const input = document.getElementById('testNames').value;
            const names = input.split(',').map(s => s.trim()).filter(s => s);
            
            if (names.length === 0) {
                result.innerHTML = '<span class="error">âŒ En az bir tedarikÃ§i adÄ± girin!</span>';
                return;
            }
            
            try {
                localStorage.setItem('supplierListForCOA', JSON.stringify(names));
                result.innerHTML = '<span class="success">âœ… Test verisi kaydedildi!</span><br><br>' +
                    `<strong>Kaydedilen:</strong> ${names.length} tedarikÃ§i<br>` +
                    names.map((s, i) => `${i+1}. ${s}`).join('<br>') + '<br><br>' +
                    '<strong>Åimdi COA ArÅŸiv sayfasÄ±nÄ± aÃ§Ä±n ve dropdown\'u kontrol edin.</strong>';
            } catch (e) {
                result.innerHTML = '<span class="error">âŒ Kaydetme hatasÄ±:</span><br>' + e.message;
            }
        }
        
        function clearData() {
            if (!confirm('âš ï¸ supplierListForCOA silinecek. Emin misiniz?')) return;
            
            const result = document.getElementById('result2');
            result.style.display = 'block';
            
            localStorage.removeItem('supplierListForCOA');
            result.innerHTML = '<span class="success">âœ… Temizlendi!</span><br><br>' +
                'Ana sayfada Excel yÃ¼kleyin ve tekrar deneyin.';
        }
        
        function showAllKeys() {
            const result = document.getElementById('result3');
            result.style.display = 'block';
            
            const keys = Object.keys(localStorage).sort();
            
            if (keys.length === 0) {
                result.innerHTML = '<span class="warning">âš ï¸ localStorage boÅŸ!</span>';
                return;
            }
            
            const supplierRelated = keys.filter(k => k.toLowerCase().includes('supplier'));
            const coaRelated = keys.filter(k => k.toLowerCase().includes('coa'));
            const other = keys.filter(k => !k.toLowerCase().includes('supplier') && !k.toLowerCase().includes('coa'));
            
            let html = `<strong>Toplam Anahtar:</strong> ${keys.length}<br><br>`;
            
            if (supplierRelated.length > 0) {
                html += '<strong>ğŸ“¦ TedarikÃ§i Ä°lgili:</strong><br>';
                html += supplierRelated.map(k => {
                    const value = localStorage.getItem(k);
                    const size = new Blob([value]).size;
                    return `  â€¢ ${k} (${(size/1024).toFixed(1)} KB)`;
                }).join('<br>') + '<br><br>';
            }
            
            if (coaRelated.length > 0) {
                html += '<strong>ğŸ“‹ COA Ä°lgili:</strong><br>';
                html += coaRelated.map(k => {
                    const value = localStorage.getItem(k);
                    const size = new Blob([value]).size;
                    return `  â€¢ ${k} (${(size/1024).toFixed(1)} KB)`;
                }).join('<br>') + '<br><br>';
            }
            
            if (other.length > 0) {
                html += '<strong>ğŸ“Œ DiÄŸer:</strong><br>';
                html += other.slice(0, 20).map(k => `  â€¢ ${k}`).join('<br>');
                if (other.length > 20) html += '<br>  ... ve ' + (other.length - 20) + ' tane daha';
            }
            
            result.innerHTML = html;
        }
        
        // Otomatik kontrol
        window.addEventListener('load', () => {
            checkSupplierList();
            setTimeout(() => {
                checkSupplierList();
            }, 2000); // 2 saniye sonra tekrar kontrol
        });
    </script>
</body>
</html>
